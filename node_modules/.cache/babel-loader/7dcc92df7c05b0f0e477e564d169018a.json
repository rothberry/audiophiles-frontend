{"ast":null,"code":"var _jsxFileName = \"/home/phil/dev/projects/soundclone/mod-5-audiofiles-frontend/src/components/Waveform.js\";\n\n/*eslint-disable */\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport WaveSurfer from \"wavesurfer.js\";\nimport { connect } from \"react-redux\";\nimport { withRouter } from \"react-router-dom\";\nimport { Button, Icon, Label, Segment, Loader } from \"semantic-ui-react\";\nconst fetchFavoritesURL = \"http://localhost:3000/favorites\";\n\nclass Waveform extends React.Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      isPlaying: false,\n      // isLoading: true,\n      pos: 0,\n      duration: 0,\n      favorites: [],\n      isFavorite: false,\n      favoriteID: \"\"\n    };\n\n    this.buildWaveForm = () => {\n      const _this$props = this.props,\n            waveHeight = _this$props.waveHeight,\n            responsive = _this$props.responsive,\n            splitChannels = _this$props.splitChannels,\n            mediaControls = _this$props.mediaControls,\n            maxCanvasWidth = _this$props.maxCanvasWidth,\n            song_link = _this$props.song_link,\n            song = _this$props.song; // TODO Move waveColor and progress color to store\n\n      let randWaveColor = '#' + (Math.random() * 0xFFFFFF << 0).toString(16);\n      let randProgColor = '#' + (Math.random() * 0xFFFFFF << 0).toString(16);\n      let waveColor = \"#0C0536\";\n      let progressColor = \"#C0BDCA\";\n      this.$el = ReactDOM.findDOMNode(this);\n      this.$waveform = this.$el.querySelector(\".wave-\".concat(song.id));\n\n      if (this.$waveform) {\n        this.wavesurfer = WaveSurfer.create({\n          container: this.$waveform,\n          mediaType: \"audio\",\n          waveColor: randWaveColor,\n          progressColor: randProgColor,\n          partialRender: true,\n          height: waveHeight,\n          maxCanvasWidth: maxCanvasWidth,\n          splitChannels: splitChannels,\n          mediaControls: mediaControls,\n          responsive: responsive\n        }); // this.$waveform.style.backgroundColor = \"black\"\n\n        this.wavesurfer.load(song_link); // this.setState({ isLoading: false })\n\n        this.wavesurfer.setVolume(1); // TODO Add duration to waveform\n      } else {\n        console.log(\"waveform loading...\");\n      }\n    };\n\n    this.setIsFavorite = user_id => {\n      const setIsFavorite = this.props.song.favorites.find(fav => {\n        return fav.user_id === user_id;\n      });\n\n      if (setIsFavorite !== undefined) {\n        this.setState({\n          favorites: this.props.song.favorites,\n          isFavorite: !!setIsFavorite,\n          favoriteID: setIsFavorite.id\n        });\n      }\n    };\n\n    this.handleTogglePlay = () => {\n      if (this.state.isPlaying) {\n        this.wavesurfer.pause();\n        this.setState({\n          isPlaying: !this.state.isPlaying,\n          pos: this.wavesurfer.getCurrentTime()\n        });\n      } else {\n        this.wavesurfer.play();\n        this.setState({\n          isPlaying: !this.state.isPlaying,\n          pos: this.wavesurfer.getCurrentTime()\n        });\n      }\n    };\n\n    this.handleStop = () => {\n      this.setState(prevState => {\n        this.wavesurfer.stop();\n        return {\n          isPlaying: false,\n          pos: 0\n        };\n      });\n    };\n\n    this.handleFavorite = e => {\n      e.preventDefault();\n\n      if (!this.state.isFavorite) {\n        const reqPostObj = {\n          method: \"POST\",\n          headers: {\n            \"Content-type\": \"application/json\"\n          },\n          body: JSON.stringify({\n            user_id: this.props.user.id,\n            song_id: this.props.song.id\n          })\n        };\n        fetch(fetchFavoritesURL, reqPostObj).then(resp => resp.json()).then(data => {\n          console.log(data);\n\n          if (!data.errors) {\n            this.setState({\n              favorites: [...this.state.favorites, data],\n              isFavorite: true,\n              favoriteID: data.id\n            });\n          }\n        }).catch(err => console.log(err));\n      } else {\n        this.handleUnfavorite();\n      }\n    };\n\n    this.handleUnfavorite = () => {\n      const reqDelObj = {\n        method: \"DELETE\"\n      };\n      fetch(\"\".concat(fetchFavoritesURL, \"/\").concat(this.state.favoriteID), reqDelObj).then(res => res.json()).then(data => {\n        if (!data.errors) {\n          let newFavArray = this.state.favorites.filter(fav => fav.id !== this.state.favoriteID);\n          this.setState({\n            favorites: newFavArray,\n            isFavorite: false\n          });\n        }\n      }).catch(err => console.log(err));\n    };\n  }\n\n  componentDidMount() {\n    this.buildWaveForm();\n    this.setIsFavorite(this.props.song.user.id);\n  }\n\n  componentWillUnmount() {\n    this.wavesurfer.empty(); // this.$waveform.firstChild.remove()\n    // this.$el.remove()\n  }\n\n  componentDidUpdate(prevProps) {\n    let isFiltered = prevProps.filtered !== this.props.filtered;\n    let isNewWave = prevProps.song_link !== this.props.song_link;\n\n    if (isFiltered || isNewWave) {\n      this.wavesurfer.empty(); // this.wavesurfer.load(this.props.song_link)\n\n      this.$waveform.firstChild.remove();\n      this.buildWaveForm();\n    }\n\n    if (!!this.props.user.id && this.props.user.id !== prevProps.user.id) {\n      this.setIsFavorite(this.props.user.id);\n    }\n  }\n\n  render() {\n    // TODO Make it so only one audio track can play at a time\n    const isLoading = this.state.isLoading;\n    const isLoggedIn = this.props.user.isLoggedIn;\n    const buttonStyle = {\n      width: \"20%\"\n    };\n    const waveStyle = {\n      backgroundColor: 'aluminum'\n    };\n    const favColor = this.state.isFavorite ? \"red\" : \"black\";\n    return React.createElement(Segment, {\n      className: \"waveform\",\n      style: {\n        cursor: \"text\"\n      },\n      raised: true,\n      color: \"blue\",\n      style: waveStyle,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 183\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"wave-\".concat(this.props.song.id),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 184\n      },\n      __self: this\n    }), !this.state.isPlaying ? React.createElement(Button, {\n      name: \"play-pause\",\n      style: buttonStyle,\n      onClick: this.handleTogglePlay,\n      circular: true,\n      icon: \"play\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 186\n      },\n      __self: this\n    }) : React.createElement(Button, {\n      name: \"play-pause\",\n      style: buttonStyle,\n      onClick: this.handleTogglePlay,\n      circular: true,\n      icon: \"pause\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 194\n      },\n      __self: this\n    }), React.createElement(Button, {\n      name: \"stop\",\n      style: buttonStyle,\n      onClick: this.handleStop,\n      circular: true,\n      icon: \"stop\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 202\n      },\n      __self: this\n    }), React.createElement(Button, {\n      as: \"div\",\n      toggle: true,\n      labelPosition: \"right\",\n      disabled: !isLoggedIn,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 209\n      },\n      __self: this\n    }, React.createElement(Button, {\n      icon: true,\n      onClick: this.handleFavorite,\n      circular: true,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 210\n      },\n      __self: this\n    }, React.createElement(Icon, {\n      color: favColor,\n      name: \"heart\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 211\n      },\n      __self: this\n    })), React.createElement(Label, {\n      basic: true,\n      pointing: \"left\",\n      circular: true,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 213\n      },\n      __self: this\n    }, this.state.favorites.length)), this.props.showCommentCount ? React.createElement(Label, {\n      icon: \"comments\",\n      iconPosition: \"left\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 218\n      },\n      __self: this\n    }, \" \", this.props.song.comments.length) : null);\n  }\n\n}\n\nconst mapStateToProps = state => {\n  return {\n    user: state.user\n  };\n};\n\nexport default connect(mapStateToProps, null)(withRouter(Waveform));","map":{"version":3,"sources":["/home/phil/dev/projects/soundclone/mod-5-audiofiles-frontend/src/components/Waveform.js"],"names":["React","ReactDOM","WaveSurfer","connect","withRouter","Button","Icon","Label","Segment","Loader","fetchFavoritesURL","Waveform","Component","state","isPlaying","pos","duration","favorites","isFavorite","favoriteID","buildWaveForm","props","waveHeight","responsive","splitChannels","mediaControls","maxCanvasWidth","song_link","song","randWaveColor","Math","random","toString","randProgColor","waveColor","progressColor","$el","findDOMNode","$waveform","querySelector","id","wavesurfer","create","container","mediaType","partialRender","height","load","setVolume","console","log","setIsFavorite","user_id","find","fav","undefined","setState","handleTogglePlay","pause","getCurrentTime","play","handleStop","prevState","stop","handleFavorite","e","preventDefault","reqPostObj","method","headers","body","JSON","stringify","user","song_id","fetch","then","resp","json","data","errors","catch","err","handleUnfavorite","reqDelObj","res","newFavArray","filter","componentDidMount","componentWillUnmount","empty","componentDidUpdate","prevProps","isFiltered","filtered","isNewWave","firstChild","remove","render","isLoading","isLoggedIn","buttonStyle","width","waveStyle","backgroundColor","favColor","cursor","length","showCommentCount","comments","mapStateToProps"],"mappings":"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","sourcesContent":["/*eslint-disable */\nimport React from \"react\"\nimport ReactDOM from \"react-dom\"\nimport WaveSurfer from \"wavesurfer.js\"\nimport { connect } from \"react-redux\"\nimport { withRouter } from \"react-router-dom\"\nimport { Button, Icon, Label, Segment, Loader } from \"semantic-ui-react\"\n\nconst fetchFavoritesURL = \"http://localhost:3000/favorites\"\n\nclass Waveform extends React.Component {\n  // TODO Add Loading animation on Waveform\n  state = {\n    isPlaying: false,\n    // isLoading: true,\n    pos: 0,\n    duration: 0,\n    favorites: [],\n    isFavorite: false,\n    favoriteID: \"\"\n  }\n\n  componentDidMount() {\n    this.buildWaveForm()\n    this.setIsFavorite(this.props.song.user.id)\n  }\n\n  buildWaveForm = () => {\n    const {\n      waveHeight,\n      responsive,\n      splitChannels,\n      mediaControls,\n      maxCanvasWidth,\n      song_link,\n      song\n    } = this.props\n    // TODO Move waveColor and progress color to store\n    let randWaveColor = '#'+(Math.random()*0xFFFFFF<<0).toString(16);\n    let randProgColor = '#'+(Math.random()*0xFFFFFF<<0).toString(16);\n    let waveColor = \"#0C0536\"\n    let progressColor = \"#C0BDCA\"\n    this.$el = ReactDOM.findDOMNode(this)\n    this.$waveform = this.$el.querySelector(`.wave-${song.id}`)\n    if (this.$waveform) {\n      this.wavesurfer = WaveSurfer.create({\n        container: this.$waveform,\n        mediaType: \"audio\",\n        waveColor: randWaveColor,\n        progressColor: randProgColor,\n        partialRender: true,\n        height: waveHeight,\n        maxCanvasWidth: maxCanvasWidth,\n        splitChannels: splitChannels,\n        mediaControls: mediaControls,\n        responsive: responsive\n      })\n\n      // this.$waveform.style.backgroundColor = \"black\"\n      this.wavesurfer.load(song_link)\n      // this.setState({ isLoading: false })\n      this.wavesurfer.setVolume(1)\n      // TODO Add duration to waveform\n    } else {\n      console.log(\"waveform loading...\")\n    }\n  }\n\n  componentWillUnmount() {\n    this.wavesurfer.empty()\n    // this.$waveform.firstChild.remove()\n    // this.$el.remove()\n  }\n\n  componentDidUpdate(prevProps) {\n\n    let isFiltered = prevProps.filtered !== this.props.filtered\n    let isNewWave = prevProps.song_link !== this.props.song_link\n    if (isFiltered || isNewWave) {\n      this.wavesurfer.empty()\n      // this.wavesurfer.load(this.props.song_link)\n      this.$waveform.firstChild.remove()\n      this.buildWaveForm()\n    }\n    if (!!this.props.user.id && this.props.user.id !== prevProps.user.id) {\n      this.setIsFavorite(this.props.user.id)\n    }\n  }\n\n  setIsFavorite = user_id => {\n    const setIsFavorite = this.props.song.favorites.find(fav => {\n      return fav.user_id === user_id\n    })\n    if (setIsFavorite !== undefined) {\n      this.setState({\n        favorites: this.props.song.favorites,\n        isFavorite: !!setIsFavorite,\n        favoriteID: setIsFavorite.id\n      })\n    }\n  }\n\n  handleTogglePlay = () => {\n    if (this.state.isPlaying) {\n      this.wavesurfer.pause()\n      this.setState({\n        isPlaying: !this.state.isPlaying,\n        pos: this.wavesurfer.getCurrentTime()\n      })\n    } else {\n      this.wavesurfer.play()\n      this.setState({\n        isPlaying: !this.state.isPlaying,\n        pos: this.wavesurfer.getCurrentTime()\n      })\n    }\n  }\n\n  handleStop = () => {\n    this.setState(prevState => {\n      this.wavesurfer.stop()\n      return { isPlaying: false, pos: 0 }\n    })\n  }\n\n  handleFavorite = e => {\n    e.preventDefault()\n    if (!this.state.isFavorite) {\n      const reqPostObj = {\n        method: \"POST\",\n        headers: { \"Content-type\": \"application/json\" },\n        body: JSON.stringify({\n          user_id: this.props.user.id,\n          song_id: this.props.song.id\n        })\n      }\n      fetch(fetchFavoritesURL, reqPostObj)\n        .then(resp => resp.json())\n        .then(data => {\n          console.log(data)\n          if (!data.errors) {\n            this.setState({\n              favorites: [...this.state.favorites, data],\n              isFavorite: true,\n              favoriteID: data.id\n            })\n          }\n        })\n        .catch(err => console.log(err))\n    } else {\n      this.handleUnfavorite()\n    }\n  }\n\n  handleUnfavorite = () => {\n    const reqDelObj = {\n      method: \"DELETE\"\n    }\n    fetch(`${fetchFavoritesURL}/${this.state.favoriteID}`, reqDelObj)\n      .then(res => res.json())\n      .then(data => {\n        if (!data.errors) {\n          let newFavArray = this.state.favorites.filter(\n            fav => fav.id !== this.state.favoriteID\n          )\n          this.setState({\n            favorites: newFavArray,\n            isFavorite: false\n          })\n        }\n      })\n      .catch(err => console.log(err))\n  }\n\n  render() {\n    // TODO Make it so only one audio track can play at a time\n    const { isLoading } = this.state\n    const { isLoggedIn } = this.props.user\n    const buttonStyle = { width: \"20%\" }\n    const waveStyle = { backgroundColor: 'aluminum' }\n    const favColor = this.state.isFavorite ? \"red\" : \"black\"\n    return (\n      <Segment className=\"waveform\" style={{ cursor: \"text\" }} raised color='blue' style={waveStyle} >\n        <div className={`wave-${this.props.song.id}`}></div>\n        {!this.state.isPlaying ? (\n          <Button\n            name=\"play-pause\"\n            style={buttonStyle}\n            onClick={this.handleTogglePlay}\n            circular\n            icon=\"play\"\n          />\n        ) : (\n          <Button\n            name=\"play-pause\"\n            style={buttonStyle}\n            onClick={this.handleTogglePlay}\n            circular\n            icon=\"pause\"\n          />\n        )}\n        <Button\n          name=\"stop\"\n          style={buttonStyle}\n          onClick={this.handleStop}\n          circular\n          icon=\"stop\"\n        />\n        <Button as=\"div\" toggle labelPosition=\"right\" disabled={!isLoggedIn}>\n          <Button icon onClick={this.handleFavorite} circular>\n            <Icon color={favColor} name=\"heart\" />\n          </Button>\n          <Label basic pointing=\"left\" circular>\n            {this.state.favorites.length}\n          </Label>\n        </Button>\n        {this.props.showCommentCount ? (\n          <Label icon=\"comments\" iconPosition=\"left\">\n            {\" \"}\n            {this.props.song.comments.length}\n          </Label>\n        ) : null}\n      </Segment>\n    )\n  }\n}\nconst mapStateToProps = state => {\n  return {\n    user: state.user\n  }\n}\n\nexport default connect(\n  mapStateToProps,\n  null\n)(withRouter(Waveform))\n"]},"metadata":{},"sourceType":"module"}